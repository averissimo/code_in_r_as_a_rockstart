<!DOCTYPE html>
<html lang="en"><head>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/quarto-contrib/live-runtime/live-runtime.js" type="module"></script>
<link href="site_libs/quarto-contrib/live-runtime/live-runtime.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.42">

  <meta name="author" content="André Veríssimo, Ph.D.">
  <meta name="dcterms.date" content="2025-04-22">
  <title>r_as_a_rockstar – Code in R like a rockstar 🎸</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #f8f8f2;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #f8f8f2; } /* Normal */
    code span.al { color: #f07178; background-color: #2a0f15; font-weight: bold; } /* Alert */
    code span.an { color: #d4d0ab; } /* Annotation */
    code span.at { color: #00e0e0; } /* Attribute */
    code span.bn { color: #d4d0ab; } /* BaseN */
    code span.bu { color: #abe338; } /* BuiltIn */
    code span.cf { color: #ffa07a; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #abe338; } /* Char */
    code span.cn { color: #ffd700; } /* Constant */
    code span.co { color: #f8f8f2; font-style: italic; } /* Comment */
    code span.cv { color: #ffd700; } /* CommentVar */
    code span.do { color: #f8f8f2; } /* Documentation */
    code span.dt { color: #ffa07a; } /* DataType */
    code span.dv { color: #d4d0ab; } /* DecVal */
    code span.er { color: #f07178; text-decoration: underline; } /* Error */
    code span.ex { color: #00e0e0; font-weight: bold; } /* Extension */
    code span.fl { color: #d4d0ab; } /* Float */
    code span.fu { color: #ffa07a; } /* Function */
    code span.im { color: #abe338; } /* Import */
    code span.in { color: #d4d0ab; } /* Information */
    code span.kw { color: #ffa07a; font-weight: bold; } /* Keyword */
    code span.op { color: #ffa07a; } /* Operator */
    code span.ot { color: #00e0e0; } /* Other */
    code span.pp { color: #dcc6e0; } /* Preprocessor */
    code span.re { color: #00e0e0; background-color: #f8f8f2; } /* RegionMarker */
    code span.sc { color: #abe338; } /* SpecialChar */
    code span.ss { color: #abe338; } /* SpecialString */
    code span.st { color: #abe338; } /* String */
    code span.va { color: #00e0e0; } /* Variable */
    code span.vs { color: #abe338; } /* VerbatimString */
    code span.wa { color: #dcc6e0; } /* Warning */
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto-d4a7f95c0e068e347d8f297b5101ea5f.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script type="module" src="site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
  <link href="site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
  <style>
  .center-xy {
    margin: 0;
    position: absolute;
    top: 50%;
    left: 50%;
    -ms-transform: translateY(-50%), translateX(-50%);
    transform: translateY(-50%), translateX(-50%);
  }
  </style>
</head>
<body class="quarto-dark">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block">
  <h1 class="title">Code in R like a rockstar 🎸</h1>
  <p class="subtitle">&nbsp;</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
André Veríssimo, Ph.D. 
</div>
        <p class="quarto-title-affiliation">
            <br>Systems Biomedicine Research Group<br>INESC-ID · Técnico Lisboa
          </p>
    </div>
</div>

  <p class="date">2025-04-22</p>
</section>
<section id="who-am-i" class="slide level2">
<h2>Who am I?</h2>
<ul>
<li><p>PhD from Técnico developing new omics models based on graph structures</p></li>
<li><p>Author and maintainer of <code>📦glmSparseNet</code> and <code>📦shiny.telemetry</code></p></li>
<li><p>Part of the core team at <code>📦teal</code> framework at Roche</p></li>
<li><p>Contributor to <span class="highlight"><strong>Pharmaverse</strong></span> and <span class="highlight"><strong>R Consortium Submission working group</strong></span></p></li>
</ul>
</section>
<section id="goal-of-the-presentation" class="slide level2">
<h2>Goal of the presentation</h2>
<div style="text-align: center;">
<div style="margin-top: 100px">
<p>Learn some tricks and <span class="highlight"><strong>best practices</strong></span><br>
<span class="highlight"><strong>in {{</strong><fa brands="" r-project="">}} development</fa></span></p>
</div>
<div style="margin-top: 50px;">
<p>At the end you will be<br>
<span class="highlight"><strong>motivated to develop better code</strong></span></p>
</div>
<div style="margin-top: 50px;">
<p>and to write <span class="highlight"><strong>reproducible code/results</strong></span></p>
</div>
</div>
</section>
<section id="base-is-cool" class="title-slide slide level1">
<h1>Base <i class="fa-brands fa-r-project" aria-label="r-project"></i> is cool</h1>
<ul>
<li>It’s open source</li>
<li>Has powerful statistical methods</li>
<li>Easy to manipulate &amp; process data</li>
<li>Great community</li>
</ul>
<div class="fragment">
<div style="color: gray">
<p>But it has some quirks…</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a>foo <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-2"><a></a>foo[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb1-3"><a></a>foo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 2</code></pre>
</div>
</div>
</div>
</section>

<section>
<section id="tricks" class="title-slide slide level1" data-background-color="#3b1200">
<h1>Tricks</h1>

<ul>
<li><i class="fa-solid fa-code-branch" aria-label="code-branch"></i>git repositories to track code</li>
<li><code>📦renv</code> to manage dependencies</li>
<li>Write readable code</li>
<li>Cache your long running calls with <code>📦memoise</code></li>
<li>Avoid <code>source(...)</code></li>
</ul>
<aside><div>
<p><i class="fa-solid fa-circle-info" aria-label="circle-info"></i> Advance R is a great book by Hadley. Visit <a href="adv-r.hadley.nz">adv-r.hadley.nz</a> to go much deeper.</p>
</div></aside></section>
<section id="git-repositories-to-track-code" class="slide level2 smaller" data-background-color="#3b1200">
<h2><i class="fa-solid fa-code-branch" aria-label="code-branch"></i> <em>git</em> repositories to track code</h2>
<div class="footer">
<p><span class="small-caps">Tricks</span></p>
</div>
<div style="margin-top: 50px;">

</div>
<div class="columns">
<div class="column" style="width:20%;">
<p><img data-src="figures/git_meme.png" style="display: block; margin: auto; padding-top: 1em;"></p>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:70%;">
<ul>
<li>With <span class="highlight"><strong>version control</strong></span> you minimize changes of losing work
<ul>
<li>Even for 1 person projects</li>
</ul></li>
<li><i class="fa-brands fa-github" aria-label="github"></i> Github Education is free for students<sup>1</sup>
<ul>
<li>Unlimited private repositories &amp; <i class="fa-solid fa-robot" aria-label="robot"></i> Copilot</li>
</ul></li>
<li>We have a <i class="fa-brands fa-github" aria-label="github"></i> github organization: <a href="https://github.com/sysbiomed">github.com/sysbiomed</a></li>
</ul>
</div></div>
<aside><ol class="aside-footnotes"><li id="fn1"><p><a href="https://github.com/education/students">github.com/education/students</a></p></li></ol></aside></section>
<section id="renv-to-manage-dependencies" class="slide level2" data-auto-animate="true" data-background-color="#3b1200">
<h2 data-id="quarto-animate-title"><code>📦renv</code> to manage dependencies</h2>
<div class="footer">
<p><span class="small-caps">Tricks</span></p>
</div>
<div class="sourceCode" id="cb3" data-code-line-numbers="2"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb3-1" class="hljs-ln-code"><a></a><span class="fu">install.packages</span>(<span class="st">"renv"</span>)</span>
<span id="cb3-2" class="hljs-ln-code"><a></a>renv<span class="sc">::</span><span class="fu">init</span>()     <span class="co"># Initialize the renv enviroment</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="renv-to-manage-dependencies-1" class="slide level2" data-auto-animate="true" data-background-color="#3b1200">
<h2 data-id="quarto-animate-title"><code>📦renv</code> to manage dependencies</h2>
<div class="footer">
<p><span class="small-caps">Tricks</span></p>
</div>
<div class="sourceCode" id="cb4" data-code-line-numbers="3-6"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb4-1" class="hljs-ln-code"><a></a><span class="fu">install.packages</span>(<span class="st">"renv"</span>)</span>
<span id="cb4-2" class="hljs-ln-code"><a></a>renv<span class="sc">::</span><span class="fu">init</span>()     <span class="co"># Initialize the renv enviroment</span></span>
<span id="cb4-3" class="hljs-ln-code"><a></a><span class="fu">install.packages</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb4-4" class="hljs-ln-code"><a></a>renv<span class="sc">::</span><span class="fu">install</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb4-5" class="hljs-ln-code"><a></a>renv<span class="sc">::</span><span class="fu">install</span>(<span class="st">"bioc::glmSparseNet"</span>)</span>
<span id="cb4-6" class="hljs-ln-code"><a></a>renv<span class="sc">::</span><span class="fu">install</span>(<span class="st">"sysbiomed/glmSparseNet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="renv-to-manage-dependencies-2" class="slide level2" data-auto-animate="true" data-background-color="#3b1200">
<h2 data-id="quarto-animate-title"><code>📦renv</code> to manage dependencies</h2>
<div class="footer">
<p><span class="small-caps">Tricks</span></p>
</div>
<div class="sourceCode" id="cb5" data-code-line-numbers="7"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb5-1" class="hljs-ln-code"><a></a><span class="fu">install.packages</span>(<span class="st">"renv"</span>)</span>
<span id="cb5-2" class="hljs-ln-code"><a></a>renv<span class="sc">::</span><span class="fu">init</span>()     <span class="co"># Initialize the renv enviroment</span></span>
<span id="cb5-3" class="hljs-ln-code"><a></a><span class="fu">install.packages</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb5-4" class="hljs-ln-code"><a></a>renv<span class="sc">::</span><span class="fu">install</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb5-5" class="hljs-ln-code"><a></a>renv<span class="sc">::</span><span class="fu">install</span>(<span class="st">"bioc::glmSparseNet"</span>)</span>
<span id="cb5-6" class="hljs-ln-code"><a></a>renv<span class="sc">::</span><span class="fu">install</span>(<span class="st">"sysbiomed/glmSparseNet"</span>)</span>
<span id="cb5-7" class="hljs-ln-code"><a></a>renv<span class="sc">::</span><span class="fu">snapshot</span>() <span class="co"># to save installed packages &amp; versions lockfile</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="renv-to-manage-dependencies-3" class="slide level2" data-auto-animate="true" data-background-color="#3b1200">
<h2 data-id="quarto-animate-title"><code>📦renv</code> to manage dependencies</h2>
<div class="footer">
<p><span class="small-caps">Tricks</span></p>
</div>
<div class="sourceCode" id="cb6" data-code-line-numbers="8"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb6-1" class="hljs-ln-code"><a></a><span class="fu">install.packages</span>(<span class="st">"renv"</span>)</span>
<span id="cb6-2" class="hljs-ln-code"><a></a>renv<span class="sc">::</span><span class="fu">init</span>()     <span class="co"># Initialize the renv enviroment</span></span>
<span id="cb6-3" class="hljs-ln-code"><a></a><span class="fu">install.packages</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb6-4" class="hljs-ln-code"><a></a>renv<span class="sc">::</span><span class="fu">install</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb6-5" class="hljs-ln-code"><a></a>renv<span class="sc">::</span><span class="fu">install</span>(<span class="st">"bioc::glmSparseNet"</span>)</span>
<span id="cb6-6" class="hljs-ln-code"><a></a>renv<span class="sc">::</span><span class="fu">install</span>(<span class="st">"sysbiomed/glmSparseNet"</span>)</span>
<span id="cb6-7" class="hljs-ln-code"><a></a>renv<span class="sc">::</span><span class="fu">snapshot</span>() <span class="co"># to save installed packages &amp; versions lockfile</span></span>
<span id="cb6-8" class="hljs-ln-code"><a></a>renv<span class="sc">::</span><span class="fu">restore</span>()  <span class="co"># to restore same versions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div style="margin-top: 50px;">

</div>

<img data-src="figures/works_on_my_laptop.png" style="margin: auto; display: block;" class="r-stretch"></section>
<section id="write-readable-code" class="slide level2" data-background-color="#3b1200">
<h2>Write readable code</h2>
<div class="footer">
<p><span class="small-caps">Tricks</span></p>
</div>
<ul>
<li>Prefix function calls with package name</li>
</ul>
<div style="margin-top: 50px;">

</div>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a><span class="fu">library</span>(rsample)</span>
<span id="cb7-2"><a></a>car_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(mtcars)</span>
<span id="cb7-3"><a></a>train_data <span class="ot">&lt;-</span> <span class="fu">training</span>(car_split)</span>
<span id="cb7-4"><a></a>test_data <span class="ot">&lt;-</span> <span class="fu">testing</span>(car_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div style="margin-top: 50px;">

</div>
<p><span class="smaller1"><em>vs.</em></span></p>
<div style="margin-top: 50px;">

</div>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a>car_split <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(mtcars)</span>
<span id="cb8-2"><a></a>train_data <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">training</span>(car_split)</span>
<span id="cb8-3"><a></a>test_data <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">testing</span>(car_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="write-readable-code-1" class="slide level2 smaller" data-background-color="#3b1200">
<h2>Write readable code</h2>
<div class="footer">
<p><span class="small-caps">Tricks</span></p>
</div>
<ul>
<li>Use return early</li>
<li>Avoid long chunks of code</li>
</ul>
<div class="sourceCode" id="cb9" data-code-line-numbers="1,4-5,8-9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a><span class="cf">if</span> (condition) {</span>
<span id="cb9-2"><a></a>  foo <span class="ot">&lt;-</span> <span class="fu">bar</span>()</span>
<span id="cb9-3"><a></a>  foo <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(zoo <span class="sc">%in%</span> whoo)</span>
<span id="cb9-4"><a></a>} <span class="cf">else</span> {</span>
<span id="cb9-5"><a></a>  <span class="fu">return</span>(something)</span>
<span id="cb9-6"><a></a>}</span>
<span id="cb9-7"><a></a></span>
<span id="cb9-8"><a></a><span class="cf">if</span> (condition2) {</span>
<span id="cb9-9"><a></a>  <span class="fu">stop</span>(<span class="st">"This is an error)</span></span>
<span id="cb9-10"><a></a><span class="st">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div style="margin-top: 50px;">

</div>
<p><span class="smaller1"><em>vs.</em></span></p>
<div style="margin-top: 50px;">

</div>
<div class="sourceCode" id="cb10" data-code-line-numbers="1,6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a><span class="cf">if</span> (<span class="sc">!</span>condition) <span class="fu">return</span>(something)</span>
<span id="cb10-2"><a></a></span>
<span id="cb10-3"><a></a>foo <span class="ot">&lt;-</span> <span class="fu">bar</span>()</span>
<span id="cb10-4"><a></a>foo <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(zoo <span class="sc">%in%</span> whoo)</span>
<span id="cb10-5"><a></a></span>
<span id="cb10-6"><a></a><span class="fu">stopifnot</span>(<span class="st">"This is an error"</span> <span class="ot">=</span> condition2) <span class="co"># !condition2 &amp;&amp; stop("This is an error)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="write-readable-code-2" class="slide level2" data-background-color="#3b1200">
<h2>Write readable code</h2>
<div class="footer">
<p><span class="small-caps">Tricks</span></p>
</div>
<ul>
<li>Use <code>📦logger</code></li>
</ul>
<div class="sourceCode" id="cb11" data-code-line-numbers="1,5-7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a>logger<span class="sc">::</span><span class="fu">log_info</span>(<span class="st">"This is an info message"</span>)</span>
<span id="cb11-2"><a></a></span>
<span id="cb11-3"><a></a>foo <span class="ot">&lt;-</span> <span class="st">"evaluated info"</span></span>
<span id="cb11-4"><a></a>logger<span class="sc">::</span><span class="fu">log_layout</span>(logger<span class="sc">::</span>layout_glue_colors)</span>
<span id="cb11-5"><a></a>logger<span class="sc">::</span><span class="fu">log_info</span>(<span class="st">"This is an {foo} message that sums '1 + 1 = { 1 + 1 }'"</span>)</span>
<span id="cb11-6"><a></a>logger<span class="sc">::</span><span class="fu">log_error</span>(<span class="st">"This is an error message"</span>)</span>
<span id="cb11-7"><a></a>logger<span class="sc">::</span><span class="fu">log_warn</span>(<span class="st">"This is an warning message"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img data-src="figures/logger.png" class="absolute" style="width: 70%; "></p>
</section></section>
<section>
<section id="base" class="title-slide slide level1" data-background-color="#191e31">
<h1>Base <i class="fa-brands fa-r-project" aria-label="r-project"></i></h1>
<blockquote>
<p>Using these will make your life easier</p>
</blockquote>
<ul>
<li><code>|&gt;</code> Pipe operator
<ul>
<li>shortcut in rstudio: <span class="highlight-soft"><em>ctrl + shift + m</em></span></li>
</ul></li>
<li><code>%||%</code></li>
<li><code>sapply</code> <em>vs.</em> <code>for (x in z) { ... }</code></li>
<li><code>Filter()</code> / <code>Reduce()</code></li>
</ul>
</section>
<section id="pipe-operator" class="slide level2 smaller" data-background-color="#191e31" data-auto-animate="true">
<h2 data-id="quarto-animate-title"><code>|&gt;</code> Pipe operator</h2>
<div class="footer">
<p><span class="small-caps">Base <i class="fa-brands fa-r-project" aria-label="r-project"></i></span></p>
</div>
<blockquote>
<p>Pipe a value into a call expression or a function expression.</p>
</blockquote>
<div style="margin-top: 50px;">

</div>
<p>Let’s create a trail of function calls</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a><span class="fu">tail</span>(<span class="fu">head</span>(<span class="fu">sort</span>(<span class="fu">scale</span>(mtcars<span class="sc">$</span>mpg)), <span class="dv">16</span>), <span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -1.6078826 -1.6078826 -1.1267104 -0.9607889 -0.8944204 -0.8446439
 [7] -0.8114596 -0.8114596 -0.7616832 -0.7119067 -0.6123539 -0.4630246
[13] -0.3800638 -0.3302874 -0.2307345 -0.1477738</code></pre>
</div>
</div>
<div style="margin-top: 50px;">

</div>
<p>Same, but with pipes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a>mtcars<span class="sc">$</span>mpg <span class="sc">|&gt;</span> <span class="fu">scale</span>() <span class="sc">|&gt;</span> <span class="fu">sort</span>() <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">16</span>) <span class="sc">|&gt;</span> <span class="fu">tail</span>(<span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -1.6078826 -1.6078826 -1.1267104 -0.9607889 -0.8944204 -0.8446439
 [7] -0.8114596 -0.8114596 -0.7616832 -0.7119067 -0.6123539 -0.4630246
[13] -0.3800638 -0.3302874 -0.2307345 -0.1477738</code></pre>
</div>
</div>
<div style="margin-top: 50px;">

</div>
</section>
<section id="pipe-operator-1" class="slide level2 smaller" data-background-color="#191e31" data-auto-animate="true">
<h2 data-id="quarto-animate-title"><code>|&gt;</code> Pipe operator</h2>
<div class="footer">
<p><span class="small-caps">Base <i class="fa-brands fa-r-project" aria-label="r-project"></i></span></p>
</div>
<p>Let’s create a trail of function calls</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a></a><span class="fu">tail</span>(</span>
<span id="cb16-2"><a></a>  <span class="fu">head</span>(</span>
<span id="cb16-3"><a></a>    <span class="fu">sort</span>(</span>
<span id="cb16-4"><a></a>      <span class="fu">scale</span>(mtcars<span class="sc">$</span>mpg)</span>
<span id="cb16-5"><a></a>    ), </span>
<span id="cb16-6"><a></a>    <span class="dv">16</span>), </span>
<span id="cb16-7"><a></a>  <span class="dv">16</span></span>
<span id="cb16-8"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -1.6078826 -1.6078826 -1.1267104 -0.9607889 -0.8944204 -0.8446439
 [7] -0.8114596 -0.8114596 -0.7616832 -0.7119067 -0.6123539 -0.4630246
[13] -0.3800638 -0.3302874 -0.2307345 -0.1477738</code></pre>
</div>
</div>
<div style="margin-top: 50px;">

</div>
<p>Same, but with pipes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a></a>mtcars<span class="sc">$</span>mpg <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a></a>  <span class="fu">scale</span>() <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a></a>  <span class="fu">sort</span>() <span class="sc">|&gt;</span> </span>
<span id="cb18-4"><a></a>  <span class="fu">head</span>(<span class="dv">16</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-5"><a></a>  <span class="fu">tail</span>(<span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -1.6078826 -1.6078826 -1.1267104 -0.9607889 -0.8944204 -0.8446439
 [7] -0.8114596 -0.8114596 -0.7616832 -0.7119067 -0.6123539 -0.4630246
[13] -0.3800638 -0.3302874 -0.2307345 -0.1477738</code></pre>
</div>
</div>
<div style="margin-top: 50px;">

</div>
</section>
<section id="pipe-operator-2" class="slide level2 smaller" data-background-color="#191e31" data-auto-animate="true">
<h2 data-id="quarto-animate-title"><span style="opacity: 0.5;"><code>|&gt;</code> Pipe operator</span></h2>
<div class="footer">
<p><span class="small-caps">Base <i class="fa-brands fa-r-project" aria-label="r-project"></i></span></p>
</div>
<div style="opacity: 0.5;">
<p>Let’s create a trail of function calls</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a></a><span class="fu">tail</span>(</span>
<span id="cb20-2"><a></a>  <span class="fu">head</span>(</span>
<span id="cb20-3"><a></a>    <span class="fu">sort</span>(</span>
<span id="cb20-4"><a></a>      <span class="fu">scale</span>(mtcars<span class="sc">$</span>mpg)</span>
<span id="cb20-5"><a></a>    ), </span>
<span id="cb20-6"><a></a>    <span class="dv">16</span>), </span>
<span id="cb20-7"><a></a>  <span class="dv">16</span></span>
<span id="cb20-8"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -1.6078826 -1.6078826 -1.1267104 -0.9607889 -0.8944204 -0.8446439
 [7] -0.8114596 -0.8114596 -0.7616832 -0.7119067 -0.6123539 -0.4630246
[13] -0.3800638 -0.3302874 -0.2307345 -0.1477738</code></pre>
</div>
</div>
</div>
<div style="margin-top: 50px;">

</div>
<div style="opacity: 0.5;">
<p>Same, but with pipes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a></a>mtcars<span class="sc">$</span>mpg <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a></a>  <span class="fu">scale</span>() <span class="sc">|&gt;</span> </span>
<span id="cb22-3"><a></a>  <span class="fu">sort</span>() <span class="sc">|&gt;</span> </span>
<span id="cb22-4"><a></a>  <span class="fu">head</span>(<span class="dv">16</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-5"><a></a>  <span class="fu">tail</span>(<span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -1.6078826 -1.6078826 -1.1267104 -0.9607889 -0.8944204 -0.8446439
 [7] -0.8114596 -0.8114596 -0.7616832 -0.7119067 -0.6123539 -0.4630246
[13] -0.3800638 -0.3302874 -0.2307345 -0.1477738</code></pre>
</div>
</div>
</div>
<div style="margin-top: 50px;">

</div>
<p><img data-src="figures/its-kinda-the-same.jpg" class="absolute" style="margin: auto auto;top: 0px; left: 0px; bottom: 0px; right: 0px; "></p>
</section>
<section id="pipe-operator-3" class="slide level2 smaller" data-background-color="#191e31">
<h2><code>|&gt;</code> Pipe operator</h2>
<div class="footer">
<p><span class="small-caps">Base <i class="fa-brands fa-r-project" aria-label="r-project"></i></span></p>
</div>
<ul>
<li>You can use it on other arguments of a function
<ul>
<li>As long as they are named</li>
</ul></li>
</ul>
<h4 id="this-feeds-the-string-to-the-wrong-argument">This feeds the string to the wrong argument</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a></a><span class="st">"a text with 1234 and 5678"</span> <span class="sc">|&gt;</span> <span class="fu">grepl</span>(<span class="st">"[0-9]+"</span>)        <span class="co"># ❌</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<div class="fragment">
<div style="margin-top: 30px;">

</div>
<h4 id="feeds-to-x-argument">Feeds to <code>x</code> argument</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a><span class="st">"a text with 1234 and 5678"</span> <span class="sc">|&gt;</span> <span class="fu">grepl</span>(<span class="st">"[0-9]+"</span>, <span class="at">x =</span> _) <span class="co"># ✅</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</div>
<div class="fragment">
<div style="margin-top: 30px;">

</div>
<p><code>grepl()</code> usage if you do not know by heart</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a><span class="fu">formals</span>(grepl) <span class="sc">|&gt;</span>                                  <span class="co"># Named list of arguments with defaults</span></span>
<span id="cb28-2"><a></a>  <span class="fu">names</span>() <span class="sc">|&gt;</span>                                       <span class="co"># Gets the names</span></span>
<span id="cb28-3"><a></a>  <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">", "</span>) <span class="sc">|&gt;</span>                        <span class="co"># Collapse names into comma separated string</span></span>
<span id="cb28-4"><a></a>  glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"usage: grepl({params})"</span>, <span class="at">params =</span> _) <span class="co"># Creates usage string</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>usage: grepl(pattern, x, ignore.case, perl, fixed, useBytes)</code></pre>
</div>
</div>
</div>
</section>
<section id="null-coalesce-operator" class="slide level2" data-background-color="#191e31">
<h2><code>%||%</code> Null Coalesce operator</h2>
<div class="footer">
<p><span class="small-caps">Base <i class="fa-brands fa-r-project" aria-label="r-project"></i></span></p>
</div>
<div class="sourceCode" id="cb30" data-code-line-numbers="2-7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a></a>foo <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb30-2"><a></a>bar <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.null</span>(foo)) {</span>
<span id="cb30-3"><a></a>  <span class="dv">0</span></span>
<span id="cb30-4"><a></a>} <span class="cf">else</span> {</span>
<span id="cb30-5"><a></a>  foo</span>
<span id="cb30-6"><a></a>}</span>
<span id="cb30-7"><a></a>bar <span class="ot">&lt;-</span> bar <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb30-8"><a></a>bar</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<div style="margin-top: 30px;">

</div>
<p><span class="smaller1"><em>vs.</em></span></p>
<div style="margin-top: 30px;">

</div>
<div class="sourceCode" id="cb32" data-code-line-numbers="2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a></a>foo <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb32-2"><a></a>bar <span class="ot">&lt;-</span> foo <span class="sc">%||%</span> <span class="dv">0</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb32-3"><a></a>bar</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
</section>
<section id="sapply-vapply" class="slide level2 smaller" data-background-color="#191e31">
<h2><code>sapply()</code> / <code>vapply()</code> / …</h2>
<div class="footer">
<p><span class="small-caps">Base <i class="fa-brands fa-r-project" aria-label="r-project"></i></span></p>
</div>
<div class="cell">
<div>
<div id="webr-1" class="exercise-cell">

</div>
<script type="webr-1-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoieCA8LSBsaXN0KGEgPSAxOjEwLCBiZXRhID0gZXhwKC0zOjMpLCBsb2dpYyA9IGMoVFJVRSxGQUxTRSxGQUxTRSxUUlVFKSlcbnJlc3VsdCA8LSBjKClcbmZvciAoLnggaW4geCkge1xuICByZXN1bHQgPC0gYyhyZXN1bHQsIG1lYW4oLngpKVxufVxucmVzdWx0IDwtIHNldE5hbWVzKHJlc3VsdCwgbmFtZXMoeCkpXG5yZXN1bHQifQ==
</script>
</div>
</div>
<div style="margin-top: 30px;">

</div>
<div class="fragment">
<div class="cell">
<div>
<div id="webr-2" class="exercise-cell">

</div>
<script type="webr-2-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoicmVzdWx0IDwtIHNhcHBseSh4LCBtZWFuKVxucmVzdWx0In0=
</script>
</div>
</div>
</div>
<div class="fragment">
<div class="sourceCode" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a></a>x_long <span class="ot">&lt;-</span> <span class="fu">rep</span>(x, <span class="dv">1000</span>)</span>
<span id="cb34-2"><a></a></span>
<span id="cb34-3"><a></a>f <span class="ot">&lt;-</span> \(x_long) {</span>
<span id="cb34-4"><a></a>  result <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb34-5"><a></a>  <span class="cf">for</span> (.x <span class="cf">in</span> x_long) result <span class="ot">&lt;-</span> <span class="fu">c</span>(result, <span class="fu">mean</span>(.x))</span>
<span id="cb34-6"><a></a>  <span class="fu">setNames</span>(result, <span class="fu">names</span>(x_long))</span>
<span id="cb34-7"><a></a>}</span>
<span id="cb34-8"><a></a>s <span class="ot">&lt;-</span> \(x_long) <span class="fu">sapply</span>(x_long, mean)</span>
<span id="cb34-9"><a></a>v <span class="ot">&lt;-</span> \(x_long) <span class="fu">vapply</span>(x_long, mean, <span class="fu">numeric</span>(<span class="dv">1</span>L))</span>
<span id="cb34-10"><a></a></span>
<span id="cb34-11"><a></a>bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb34-12"><a></a>  <span class="st">"for"</span> <span class="ot">=</span> <span class="fu">f</span>(x_long), <span class="st">"sapply"</span> <span class="ot">=</span> <span class="fu">s</span>(x_long), <span class="st">"vapply"</span> <span class="ot">=</span> <span class="fu">v</span>(x_long)</span>
<span id="cb34-13"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img data-src="figures/benchmark.png"></p>
</div>
</section>
<section id="mclapply" class="slide level2 smaller" data-background-color="#191e31">
<h2><code>mclapply()</code></h2>
<p>When using <code>lapply()</code> or <code>sapply()</code> on large datasets, you can use <code>mclapply()</code> to parallelize the process.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35" data-code-line-numbers="1-8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a></a><span class="fu">library</span>(parallel)</span>
<span id="cb35-2"><a></a></span>
<span id="cb35-3"><a></a>m <span class="ot">&lt;-</span> \(x_long) <span class="fu">mclapply</span>(</span>
<span id="cb35-4"><a></a>  x_long,</span>
<span id="cb35-5"><a></a>  mean,</span>
<span id="cb35-6"><a></a>  <span class="at">mc.cores =</span> <span class="dv">4</span>,</span>
<span id="cb35-7"><a></a>  <span class="at">mc.preschedule =</span> <span class="cn">TRUE</span> <span class="co"># 4 cores running each 1/4 of the input</span></span>
<span id="cb35-8"><a></a>                        <span class="co"># vs. FALSE where 1 fork is created for each input</span></span>
<span id="cb35-9"><a></a>)</span>
<span id="cb35-10"><a></a></span>
<span id="cb35-11"><a></a>x_long <span class="ot">&lt;-</span> <span class="fu">rep</span>(x, <span class="dv">30000</span>) <span class="co"># let's make it worth it</span></span>
<span id="cb35-12"><a></a>bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb35-13"><a></a>  <span class="st">"for"</span> <span class="ot">=</span> <span class="fu">f</span>(x_long), <span class="st">"sapply"</span> <span class="ot">=</span> <span class="fu">s</span>(x_long), <span class="st">"vapply"</span> <span class="ot">=</span> <span class="fu">v</span>(x_long), <span class="st">"mclapply"</span> <span class="ot">=</span> <span class="fu">m</span>(x_long), <span class="at">memory =</span> <span class="cn">FALSE</span>, <span class="at">check =</span> <span class="cn">FALSE</span></span>
<span id="cb35-14"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 6
  expression      min   median `itr/sec` mem_alloc `gc/sec`
  &lt;bch:expr&gt; &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;
1 for           7.89s    7.89s     0.127        NA     93.0
2 sapply     274.94ms 285.42ms     3.50         NA     17.5
3 vapply     279.74ms 281.36ms     3.55         NA     16.0
4 mclapply   141.07ms  161.6ms     6.15         NA     38.4</code></pre>
</div>
</div>
<div class="footer">
<p><span class="small-caps">Base <i class="fa-brands fa-r-project" aria-label="r-project"></i></span></p>
</div>
</section>
<section id="reduce-filter" class="slide level2 smaller" data-background-color="#191e31">
<h2><code>Reduce()</code> / <code>Filter()</code></h2>
<div class="footer">
<p><span class="small-caps">Base <i class="fa-brands fa-r-project" aria-label="r-project"></i></span></p>
</div>
<div class="cell">
<div>
<div id="webr-3" class="exercise-cell">

</div>
<script type="webr-3-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoidG90YWwgPC0gUmVkdWNlKFxuICBcXCh1LCB4KSB1ICsgeF4yLFxuICAxOjEwLFxuICBpbml0ID0gMFxuKVxudG90YWwifQ==
</script>
</div>
</div>
<div class="cell">
<div>
<div id="webr-4" class="exercise-cell">

</div>
<script type="webr-4-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiZm9vIDwtIGMobGlzdChOVUxMKSwgMToxMCwgTlVMTCwgMTE6MTIpXG5mb28gfD4gcGFzdGUoY29sbGFwc2UgPSBcIiwgXCIpXG5GaWx0ZXIoXG4gIFxcKHgpIHggPCA1ICYmICFpcy5udWxsKHgpLFxuICBmb29cbil8PiBwYXN0ZShjb2xsYXBzZSA9IFwiLCBcIilcblxuZm9vW3NhcHBseShmb28sIE5lZ2F0ZShpcy5udWxsKSldfD4gcGFzdGUoY29sbGFwc2UgPSBcIiwgXCIpIn0=
</script>
</div>
</div>
<div class="fragment">
<p>Keep an eye in a few slides for <code>📦purrr</code> that has similar functions</p>
</div>
</section>
<section id="local" class="slide level2 smaller" data-background-color="#191e31">
<h2><code>local()</code></h2>

<p>Useful for when you create a lot of intermediate variables that are never necessary.</p>
<div class="cell">
<div>
<div id="webr-5" class="exercise-cell">

</div>
<script type="webr-5-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoidG90YWwgPC0gbG9jYWwoe1xuICB0b3RhbF9sb2NhbCA8LSAwXG4gIGZvciAoeDIgaW4gMToxMikge1xuICAgIHkyIDwtIHgyXjJcbiAgICB0b3RhbF9sb2NhbCA8LSB0b3RhbF9sb2NhbCArIHkyXG4gIH1cbiAgdG90YWxfbG9jYWxcbn0pXG50b3RhbCJ9
</script>
</div>
</div>
<div class="footer">
<p><span class="small-caps">Base <i class="fa-brands fa-r-project" aria-label="r-project"></i></span></p>
</div>
<aside><div>
<p><i class="fa-solid fa-circle-info" aria-label="circle-info"></i> <code>&lt;&lt;-</code> allows to write to parent environment <em>(use with care)</em></p>
</div></aside></section></section>
<section>
<section id="section" class="title-slide slide level1 no-title" data-background-color="#1a162d">
<h1></h1>
<p><img data-src="figures/tidyverse.png" class="absolute" style="margin: auto auto;top: 0px; left: 0px; right: 0px; width: 90%; "></p>

<aside><div>
<p>Learn more at <a href="https://www.tidyverse.org">tidyverse.org</a></p>
</div></aside></section>
<section id="dplyr" class="slide level2 smaller scrollable" data-background-color="#1a162d">
<h2><code>📦dplyr</code></h2>
<div class="footer">
<p>tidyverse</p>
</div>
<div class="fragment semi-fade-out" data-fragment-index="1">
<blockquote>
<p>A grammar of data manipulation</p>
</blockquote>
<div class="cell">
<div>
<div id="webr-6" class="exercise-cell">

</div>
<script type="webr-6-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiaXJpcyB8PiBcbiAgZHBseXI6OnNlbGVjdChTcGVjaWVzLCBTZXBhbC5MZW5ndGgpIHw+IFxuICBkcGx5cjo6Z3JvdXBfYnkoU3BlY2llcykgfD5cbiAgZHBseXI6Om11dGF0ZShTZXBhbC5MZW5ndGgucmVsYXRpdmUgPSBTZXBhbC5MZW5ndGggLyBtZWFuKFNlcGFsLkxlbmd0aCkpIn0=
</script>
</div>
</div>
<div style="padding-left: 2em; font-size: .6em;">
<p><i class="fa-solid fa-circle-info" aria-label="circle-info"></i> <code>📦dplyr</code> is an acceptable exception to the practice of prefixing function calls with package name.</p>
</div>
</div>
<div class="fragment fade-in-then-semi-out" data-fragment-index="1">
<div style="margin-top: 30px;">

</div>
<p>Manual approach</p>
<div class="cell">
<div>
<div id="webr-7" class="exercise-cell">

</div>
<script type="webr-7-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiUmVkdWNlKFxuICBmdW5jdGlvbih1LCB2KSB7XG4gICAgc3BfbCA8LSBpcmlzJFNlcGFsLkxlbmd0aFtpcmlzJFNwZWNpZXMgPT0gdl0gfD4gbWVhbigpXG4gICAgcmJpbmQoXG4gICAgICB1LFxuICAgICAgY2JpbmQoXG4gICAgICAgIGlyaXNbaXJpcyRTcGVjaWVzID09IHYsIGMoXCJTcGVjaWVzXCIsIFwiU2VwYWwuTGVuZ3RoXCIpXSxcbiAgICAgICAgU2VwYWwuTGVuZ3RoLnJlbGF0aXZlID0gaXJpcyRTZXBhbC5MZW5ndGhbaXJpcyRTcGVjaWVzID09IHZdIC8gc3BfbFxuICAgICAgKVxuICAgIClcbiAgfSxcbiAgYyhcInNldG9zYVwiLCBcInZlcnNpY29sb3JcIiwgXCJ2aXJnaW5pY2FcIiksXG4gIGluaXQgPSBkYXRhLmZyYW1lKClcbikgfD4gZHBseXI6OnRpYmJsZSgpIn0=
</script>
</div>
</div>
</div>
<div class="fragment fade-in-then-semi-out">
<div style="margin-top: 30px;">

</div>
<p>The same with <code>stats::ave()</code></p>
<div class="cell">
<div>
<div id="webr-8" class="exercise-cell">

</div>
<script type="webr-8-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiaXJpc19hdmUgPC0gaXJpc1ssIGMoXCJTcGVjaWVzXCIsIFwiU2VwYWwuTGVuZ3RoXCIpXVxuaXJpc19hdmUkU2VwYWwuTGVuZ3RoLnJlbGF0aXZlIDwtIGlyaXMkU2VwYWwuTGVuZ3RoIC8gYXZlKGlyaXMkU2VwYWwuTGVuZ3RoLCBpcmlzJFNwZWNpZXMsIEZVTiA9IG1lYW4pXG5kcGx5cjo6dGliYmxlKGlyaXNfYXZlKSJ9
</script>
</div>
</div>
</div>
<div class="fragment fade-in-then-semi-out">
<div style="margin-top: 30px;">

</div>
<p>The same in data.tables</p>
<div class="cell">
<div>
<div id="webr-9" class="exercise-cell">

</div>
<script type="webr-9-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoibGlicmFyeShkYXRhLnRhYmxlKVxuaXJpc19kdCA8LSBhcy5kYXRhLnRhYmxlKGlyaXNbLCBjKFwiU3BlY2llc1wiLCBcIlNlcGFsLkxlbmd0aFwiKV0gKVxuaXJpc19kdFssIFNlcGFsLkxlbmd0aC5yZWxhdGl2ZSA6PSBTZXBhbC5MZW5ndGggLyBtZWFuKFNlcGFsLkxlbmd0aCksIGJ5ID0gU3BlY2llc10gfD4gXG4gIGRwbHlyOjp0aWJibGUoKSJ9
</script>
</div>
</div>
</div>
</section>
<section id="tidyr" class="slide level2 smaller" data-background-color="#1a162d">
<h2><code>📦tidyr</code></h2>
<div class="footer">
<p>tidyverse</p>
</div>
<div class="columns">
<div class="column" style="width:50%;">
<p>Original data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a></a><span class="co">#</span></span>
<span id="cb37-2"><a></a><span class="co">#</span></span>
<span id="cb37-3"><a></a><span class="co">#</span></span>
<span id="cb37-4"><a></a><span class="co">#</span></span>
<span id="cb37-5"><a></a>tidyr<span class="sc">::</span>relig_income <span class="sc">|&gt;</span> </span>
<span id="cb37-6"><a></a>  <span class="fu">print</span>(<span class="at">width =</span> <span class="dv">50</span>, <span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 11
   religion  `&lt;$10k` `$10-20k` `$20-30k` `$30-40k`
   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 Agnostic       27        34        60        81
 2 Atheist        12        27        37        52
 3 Buddhist       27        21        30        34
 4 Catholic      418       617       732       670
 5 Don’t kn…      15        14        15        11
 6 Evangeli…     575       869      1064       982
 7 Hindu           1         9         7         9
 8 Historic…     228       244       236       238
 9 Jehovah'…      20        27        24        24
10 Jewish         19        19        25        25
# ℹ 8 more rows
# ℹ 6 more variables: `$40-50k` &lt;dbl&gt;,
#   `$50-75k` &lt;dbl&gt;, `$75-100k` &lt;dbl&gt;,
#   `$100-150k` &lt;dbl&gt;, `&gt;150k` &lt;dbl&gt;,
#   `Don't know/refused` &lt;dbl&gt;</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<p><code>tidyr::pivot_longer()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a></a>tidyr<span class="sc">::</span>relig_income <span class="sc">|&gt;</span></span>
<span id="cb39-2"><a></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb39-3"><a></a>    <span class="sc">!</span>religion, </span>
<span id="cb39-4"><a></a>    <span class="at">names_to =</span> <span class="st">"income"</span>,  </span>
<span id="cb39-5"><a></a>    <span class="at">values_to =</span> <span class="st">"count"</span></span>
<span id="cb39-6"><a></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 × 3
   religion income             count
   &lt;chr&gt;    &lt;chr&gt;              &lt;dbl&gt;
 1 Agnostic &lt;$10k                 27
 2 Agnostic $10-20k               34
 3 Agnostic $20-30k               60
 4 Agnostic $30-40k               81
 5 Agnostic $40-50k               76
 6 Agnostic $50-75k              137
 7 Agnostic $75-100k             122
 8 Agnostic $100-150k            109
 9 Agnostic &gt;150k                 84
10 Agnostic Don't know/refused    96
# ℹ 170 more rows</code></pre>
</div>
</div>
</div></div>
</section>
<section id="tidyr-1" class="slide level2 smaller" data-background-color="#1a162d">
<h2><code>📦tidyr</code></h2>
<div class="footer">
<p>tidyverse</p>
</div>
<div class="columns">
<div class="column" style="width:30%;">
<p>Original data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a></a><span class="co">#</span></span>
<span id="cb41-2"><a></a><span class="co">#</span></span>
<span id="cb41-3"><a></a>tidyr<span class="sc">::</span>fish_encounters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 114 × 3
   fish  station  seen
   &lt;fct&gt; &lt;fct&gt;   &lt;int&gt;
 1 4842  Release     1
 2 4842  I80_1       1
 3 4842  Lisbon      1
 4 4842  Rstr        1
 5 4842  Base_TD     1
 6 4842  BCE         1
 7 4842  BCW         1
 8 4842  BCE2        1
 9 4842  BCW2        1
10 4842  MAE         1
# ℹ 104 more rows</code></pre>
</div>
</div>
</div><div class="column" style="width:70%;">
<p><code>tidyr::pivot_wider()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a></a>tidyr<span class="sc">::</span>fish_encounters <span class="sc">|&gt;</span> </span>
<span id="cb43-2"><a></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> station, <span class="at">values_from =</span> seen) <span class="sc">|&gt;</span></span>
<span id="cb43-3"><a></a>  <span class="fu">print</span>(<span class="at">width =</span> <span class="dv">60</span>, <span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19 × 12
   fish  Release I80_1 Lisbon  Rstr Base_TD   BCE   BCW
   &lt;fct&gt;   &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1 4842        1     1      1     1       1     1     1
 2 4843        1     1      1     1       1     1     1
 3 4844        1     1      1     1       1     1     1
 4 4845        1     1      1     1       1    NA    NA
 5 4847        1     1      1    NA      NA    NA    NA
 6 4848        1     1      1     1      NA    NA    NA
 7 4849        1     1     NA    NA      NA    NA    NA
 8 4850        1     1     NA     1       1     1     1
 9 4851        1     1     NA    NA      NA    NA    NA
10 4854        1     1     NA    NA      NA    NA    NA
# ℹ 9 more rows
# ℹ 4 more variables: BCE2 &lt;int&gt;, BCW2 &lt;int&gt;, MAE &lt;int&gt;,
#   MAW &lt;int&gt;</code></pre>
</div>
</div>
</div></div>
</section>
<section id="purrr" class="slide level2 smaller" data-background-color="#1a162d">
<h2><code>📦purrr</code></h2>
<div class="footer">
<p>tidyverse</p>
</div>
<div class="fragment semi-fade-out" data-fragment-index="1">
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a></a>purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="fu">list</span>(<span class="at">a =</span> <span class="fu">list</span>(<span class="at">b =</span> <span class="dv">2</span>)), <span class="st">"a"</span>, <span class="st">"b"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
</div>
<div class="fragment fade-in-then-semi-out" data-fragment-index="1">
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a></a>purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="fu">list</span>(<span class="at">c =</span> <span class="dv">3</span>), <span class="st">"foo"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
</div>
<div class="fragment fade-in-then-semi-out" data-fragment-index="2">
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a></a>purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="fu">list</span>(<span class="at">c =</span> <span class="dv">3</span>), <span class="st">"foo"</span>, <span class="at">.default =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
</div>
<div class="fragment fade-in-then-semi-out" data-fragment-index="3">
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a></a>purrr<span class="sc">::</span><span class="fu">keep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="sc">~</span>.x <span class="sc">&lt;</span> <span class="dv">5</span>) <span class="co"># keep values below 5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 4</code></pre>
</div>
</div>
</div>
<div class="fragment fade-in-then-semi-out" data-fragment-index="4">
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a></a>purrr<span class="sc">::</span><span class="fu">discard</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="sc">~</span>.x <span class="sc">&gt;=</span> <span class="dv">5</span>) <span class="co"># discard values above 5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 4</code></pre>
</div>
</div>
</div>
<div class="fragment fade-in-then-semi-out" data-fragment-index="5">
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a></a><span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="cn">NULL</span>, <span class="dv">4</span>, <span class="cn">NULL</span>) <span class="sc">|&gt;</span> <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">", "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1, 2, 3, NULL, 4, NULL"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a></a>purrr<span class="sc">::</span><span class="fu">compact</span>(<span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="cn">NULL</span>, <span class="dv">4</span>, <span class="cn">NULL</span>)) <span class="sc">|&gt;</span> <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">", "</span>) <span class="co"># remove NULL values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1, 2, 3, 4"</code></pre>
</div>
</div>
</div>
</section>
<section id="glue" class="slide level2 smaller" data-background-color="#1a162d">
<h2><code>📦glue</code></h2>
<div class="footer">
<p>tidyverse</p>
</div>

<blockquote>
<p>Easy function to generate strings</p>
</blockquote>
<p><code>glue()</code> has access to the environment and can evaluate expressions</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a></a>title <span class="ot">&lt;-</span> <span class="st">"Code in R like a rockstar 🎸"</span></span>
<span id="cb59-2"><a></a>glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"The current time is {Sys.time()}</span><span class="sc">\n</span><span class="st">  and the title of this presentation is: '{title}'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The current time is 2025-04-22 16:06:05.648372
and the title of this presentation is: 'Code in R like a rockstar 🎸'</code></pre>
</div>
</div>
<div style="margin-top: 50px;">

</div>
<p>Data can come from other sources, such as a <em>dataframe</em> <em>(a list or an environment)</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a></a><span class="fu">head</span>(mtcars, <span class="at">n =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb61-2"><a></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"model"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb61-3"><a></a>  glue<span class="sc">::</span><span class="fu">glue_data</span>(<span class="st">"{model} has {hp} hp."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mazda RX4 has 110 hp.
Mazda RX4 Wag has 110 hp.
Datsun 710 has 93 hp.</code></pre>
</div>
</div>
<aside><div>
<p><i class="fa-solid fa-circle-info" aria-label="circle-info"></i> when going for efficient code, use <code>sprintf()</code><br>
Can be used with <code>dplyr::mutate()</code> as well as other tidyverse packages</p>
</div></aside></section>
<section id="ggplot2-source-gist" class="slide level2 smaller" data-background-color="#1a162d">
<h2><code>📦ggplot2</code> (source <a href="https://gist.github.com/averissimo/8804d3ffed0613f9f912c4ef3465fbc1">gist</a>)</h2>
<p><img data-src="figures/electricity.png">{.absolute left=0 right=0 top=40 style=“margin: auto auto; }</p>
</section>
<section id="ggplot2" class="slide level2" data-background-color="#1a162d">
<h2><code>📦ggplot2</code></h2>
<p><img data-src="figures/electricity.png" class="absolute" style="margin: auto auto; scale: 1.5; transform: scale(1.25, 1.25) translate(0, 18%);top: 0px; left: 0px; right: 0px; "></p>
</section></section>
<section>
<section id="memoise" class="title-slide slide level1 smaller scrollable">
<h1><code>📦memoise</code></h1>
<blockquote>
<p>Memoisation is an <span class="highlight"><strong>optimization technique to speed up computer programs by storing the results of expensive function calls</strong></span> and returning the cached result when the same inputs occur again</p>
</blockquote>
<div class="cell" data-autorun="true">
<div>
<div id="webr-10" class="exercise-cell">

</div>
<script type="webr-10-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiZm9vIDwtIGZ1bmN0aW9uKHgpIHtcbiAgU3lzLnNsZWVwKDEpICMgU2ltdWxhdGUgYSBsb25nIGNhbGN1bGF0aW9uXG4gIHheMlxufVxuXG5jYWNoZSA8LSBjYWNoZW06OmNhY2hlX2Rpc2soXCJtZW1vaXNlXCIpICAgICAgICAgICMgS2VlcCBwZXJzaXN0ZW50IGNhY2hlXG5mb29fbWVtIDwtIG1lbW9pc2U6Om1lbW9pc2UoZm9vLCBjYWNoZSA9IGNhY2hlKSAjIE1lbW9pc2UgdGhlIGZ1bmN0aW9uXG5cbnRpYyA8LSB0aWN0b2M6OnRpYygpXG5yZXN1bHQgPC0gUmVkdWNlKFxuICBcXCh1LCB2KSB1ICsgZm9vX21lbSh2KSxcbiAgaW5pdCA9IDAsXG4gIHggPSAxOjEwXG4pXG50aWN0b2M6OnRvYygpIn0=
</script>
</div>
</div>
</section>
<section id="memoise-1" class="slide level2 scrollable">
<h2><code>📦memoise</code></h2>
<div class="smaller2">
<ul>
<li>Let’s:
<ul>
<li><span class="highlight"><strong>Build lung survival data</strong></span></li>
<li>Train model on 80% of the data</li>
<li>Test on the remaining 20%</li>
<li>Run logrank test and calculate <code>p_value</code></li>
</ul></li>
<li>Repeat 100</li>
</ul>
<div style="margin-top: 30px;">

</div>
<div class="sourceCode" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a></a><span class="co"># Auxiliary function to generate x and y from a split</span></span>
<span id="cb63-2"><a></a>gen_x_y <span class="ot">&lt;-</span> \(fun, split, <span class="at">dat =</span> <span class="fu">fun</span>(split)) <span class="fu">list</span>(</span>
<span id="cb63-3"><a></a>  <span class="at">x =</span> <span class="fu">model.matrix</span>(surv_obj <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> ph_ecog <span class="sc">+</span> wt_loss, <span class="at">data =</span> dat)[, <span class="sc">-</span><span class="dv">1</span>],</span>
<span id="cb63-4"><a></a>  <span class="at">y =</span> dat<span class="sc">$</span>surv_obj</span>
<span id="cb63-5"><a></a>)</span>
<span id="cb63-6"><a></a></span>
<span id="cb63-7"><a></a>cache <span class="ot">&lt;-</span> cachem<span class="sc">::</span><span class="fu">cache_disk</span>(<span class="st">"cache"</span>) <span class="co"># Use local disk cache (tweak `max_size` for your needs)</span></span>
<span id="cb63-8"><a></a></span>
<span id="cb63-9"><a></a><span class="co">#</span></span>
<span id="cb63-10"><a></a><span class="co"># Build data</span></span>
<span id="cb63-11"><a></a>lung <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(survival<span class="sc">::</span>lung) <span class="sc">|&gt;</span></span>
<span id="cb63-12"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb63-13"><a></a>    <span class="at">.keep =</span> <span class="st">"none"</span>,</span>
<span id="cb63-14"><a></a>    <span class="at">surv_obj =</span> survival<span class="sc">::</span><span class="fu">Surv</span>(time, status <span class="sc">==</span> <span class="dv">2</span>),</span>
<span id="cb63-15"><a></a>    <span class="at">event =</span> status <span class="sc">==</span> <span class="dv">2</span>, age, <span class="at">sex =</span> <span class="fu">factor</span>(sex), <span class="at">ph_ecog =</span> <span class="fu">factor</span>(ph.ecog),</span>
<span id="cb63-16"><a></a>    <span class="at">wt_loss =</span> wt.loss</span>
<span id="cb63-17"><a></a>  )</span>
<span id="cb63-18"><a></a>  </span>
<span id="cb63-19"><a></a>cv_model <span class="ot">&lt;-</span> memoise<span class="sc">::</span><span class="fu">memoise</span>(glmnet<span class="sc">::</span>cv.glmnet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="memoise-2" class="slide level2 smaller scrollable">
<h2><code>📦memoise</code></h2>
<ul>
<li>Let’s:
<ul>
<li>Build lung survival data</li>
<li><span class="highlight"><strong>Train model on 80% of the data</strong></span></li>
<li>Test on the remaining 20%</li>
<li>Run logrank test and calculate <code>p_value</code></li>
</ul></li>
<li>Repeat 100</li>
</ul>
<div style="margin-top: 30px;">

</div>
<div class="sourceCode" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a></a>split <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(lung, <span class="at">prop =</span> <span class="fl">0.8</span>, <span class="at">strata =</span> <span class="st">"event"</span>)</span>
<span id="cb64-2"><a></a>lung_train <span class="ot">&lt;-</span> <span class="fu">gen_x_y</span>(rsample<span class="sc">::</span>training, split)</span>
<span id="cb64-3"><a></a>cvfit <span class="ot">&lt;-</span> <span class="fu">cv_model</span>(lung_train<span class="sc">$</span>x, lung_train<span class="sc">$</span>y, <span class="at">family =</span> <span class="st">"cox"</span>) <span class="co"># fit model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="memoise-3" class="slide level2 scrollable smaller">
<h2><code>📦memoise</code></h2>
<ul>
<li>Let’s:
<ul>
<li>Build lung survival data</li>
<li>Train model on 80% of the data</li>
<li><span class="highlight"><strong>Test on the remaining 20%</strong></span></li>
<li>Run logrank test and calculate <code>p_value</code></li>
</ul></li>
<li>Repeat 100</li>
</ul>
<div style="margin-top: 30px;">

</div>
<div class="sourceCode" id="cb65" data-code-line-numbers="1,2,4,5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a></a>lung_test <span class="ot">&lt;-</span> <span class="fu">gen_x_y</span>(rsample<span class="sc">::</span>testing, split)</span>
<span id="cb65-2"><a></a><span class="fu">set.seed</span>(seed <span class="sc">*</span> <span class="dv">42</span>) <span class="co"># Just in case</span></span>
<span id="cb65-3"><a></a><span class="fu">tryCatch</span>( <span class="co"># Logrank test and extract p-value (defaults to 1 if only 1 group</span></span>
<span id="cb65-4"><a></a>  cvfit <span class="sc">|&gt;</span> </span>
<span id="cb65-5"><a></a>    stats<span class="sc">::</span><span class="fu">predict</span>(<span class="at">newx =</span> lung_test<span class="sc">$</span>x, <span class="at">s =</span> <span class="st">"lambda.min"</span>, <span class="at">type =</span> <span class="st">"link"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb65-6"><a></a>    dplyr<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">risk_score =</span> _, <span class="at">y =</span> lung_test<span class="sc">$</span>y) <span class="sc">|&gt;</span> </span>
<span id="cb65-7"><a></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">risk_group =</span> dplyr<span class="sc">::</span><span class="fu">if_else</span>(risk_score <span class="sc">&gt;</span> <span class="fu">median</span>(risk_score), <span class="st">"high"</span>, <span class="st">"low"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb65-8"><a></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>risk_score) <span class="sc">|&gt;</span> </span>
<span id="cb65-9"><a></a>    survival<span class="sc">::</span><span class="fu">survdiff</span>(y <span class="sc">~</span> risk_group, <span class="at">data =</span> _) <span class="sc">|&gt;</span> </span>
<span id="cb65-10"><a></a>    <span class="fu">.subset2</span>(<span class="st">"pvalue"</span>),</span>
<span id="cb65-11"><a></a>  <span class="at">error =</span> \(e) <span class="dv">1</span> <span class="co"># In case there is only 1 group</span></span>
<span id="cb65-12"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="memoise-4" class="slide level2 scrollable smaller">
<h2><code>📦memoise</code></h2>
<ul>
<li>Let’s:
<ul>
<li>Build lung survival data</li>
<li>Train model on 80% of the data</li>
<li>Test on the remaining 20%</li>
<li><span class="highlight"><strong>Run logrank test and calculate <code>p_value</code></strong></span></li>
</ul></li>
<li>Repeat 100</li>
</ul>
<div style="margin-top: 30px;">

</div>
<div class="sourceCode" id="cb66" data-code-line-numbers="5-10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a></a>lung_test <span class="ot">&lt;-</span> <span class="fu">gen_x_y</span>(rsample<span class="sc">::</span>testing, split)</span>
<span id="cb66-2"><a></a><span class="fu">set.seed</span>(seed <span class="sc">*</span> <span class="dv">42</span>) <span class="co"># Just in case</span></span>
<span id="cb66-3"><a></a><span class="fu">tryCatch</span>( <span class="co"># Logrank test and extract p-value (defaults to 1 if only 1 group</span></span>
<span id="cb66-4"><a></a>  cvfit <span class="sc">|&gt;</span> </span>
<span id="cb66-5"><a></a>    stats<span class="sc">::</span><span class="fu">predict</span>(<span class="at">newx =</span> lung_test<span class="sc">$</span>x, <span class="at">s =</span> <span class="st">"lambda.min"</span>, <span class="at">type =</span> <span class="st">"link"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb66-6"><a></a>    dplyr<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">risk_score =</span> _, <span class="at">y =</span> lung_test<span class="sc">$</span>y) <span class="sc">|&gt;</span> </span>
<span id="cb66-7"><a></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">risk_group =</span> dplyr<span class="sc">::</span><span class="fu">if_else</span>(risk_score <span class="sc">&gt;</span> <span class="fu">median</span>(risk_score), <span class="st">"high"</span>, <span class="st">"low"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb66-8"><a></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>risk_score) <span class="sc">|&gt;</span> </span>
<span id="cb66-9"><a></a>    survival<span class="sc">::</span><span class="fu">survdiff</span>(y <span class="sc">~</span> risk_group, <span class="at">data =</span> _) <span class="sc">|&gt;</span> </span>
<span id="cb66-10"><a></a>    purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="st">"pvalue"</span>),</span>
<span id="cb66-11"><a></a>  <span class="at">error =</span> \(e) <span class="dv">1</span> <span class="co"># In case there is only 1 group</span></span>
<span id="cb66-12"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="memoise-5" class="slide level2 scrollable smaller">
<h2><code>📦memoise</code></h2>
<div class="r-stack">
<div class="fragment semi-fade-out" data-fragment-index="1" style="width: 100%">
<ul>
<li>Let’s:
<ul>
<li>Build lung survival data</li>
<li>Train model on 80% of the data</li>
<li>Test on the remaining 20%</li>
<li>Run logrank test and calculate <code>p_value</code></li>
</ul></li>
<li><span class="highlight"><strong>Repeat 100</strong></span></li>
</ul>
<div style="margin-top: 30px;">

</div>
<div class="sourceCode" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a></a>tictoc<span class="sc">::</span><span class="fu">tic</span>(tic_str)</span>
<span id="cb67-2"><a></a>p_values <span class="ot">&lt;-</span> <span class="fu">vapply</span>(</span>
<span id="cb67-3"><a></a>  <span class="fu">seq_len</span>(<span class="dv">200</span>),</span>
<span id="cb67-4"><a></a>  \(seed) {</span>
<span id="cb67-5"><a></a>    <span class="co"># code</span></span>
<span id="cb67-6"><a></a>  },</span>
<span id="cb67-7"><a></a>  <span class="fu">numeric</span>(<span class="dv">1</span>L)</span>
<span id="cb67-8"><a></a>)</span>
<span id="cb67-9"><a></a>tictoc<span class="sc">::</span><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment" data-fragment-index="1" style="background-color: black;">
<div class="sourceCode" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a></a>tictoc<span class="sc">::</span><span class="fu">tic</span>(tic_str)</span>
<span id="cb68-2"><a></a>p_values <span class="ot">&lt;-</span> <span class="fu">vapply</span>(</span>
<span id="cb68-3"><a></a>  <span class="fu">seq_len</span>(<span class="dv">200</span>),</span>
<span id="cb68-4"><a></a>  \(seed) {</span>
<span id="cb68-5"><a></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb68-6"><a></a>    <span class="co"># Split the data in 80% training / 20% testing</span></span>
<span id="cb68-7"><a></a>    split <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(lung, <span class="at">prop =</span> <span class="fl">0.8</span>, <span class="at">strata =</span> <span class="st">"event"</span>)</span>
<span id="cb68-8"><a></a>    lung_train <span class="ot">&lt;-</span> <span class="fu">gen_x_y</span>(rsample<span class="sc">::</span>training, split)</span>
<span id="cb68-9"><a></a>    cvfit <span class="ot">&lt;-</span> <span class="fu">cv_model</span>(lung_train<span class="sc">$</span>x, lung_train<span class="sc">$</span>y, <span class="at">family =</span> <span class="st">"cox"</span>) <span class="co"># fit model</span></span>
<span id="cb68-10"><a></a>    </span>
<span id="cb68-11"><a></a>    lung_test <span class="ot">&lt;-</span> <span class="fu">gen_x_y</span>(rsample<span class="sc">::</span>testing, split)</span>
<span id="cb68-12"><a></a>    <span class="fu">set.seed</span>(seed <span class="sc">*</span> <span class="dv">42</span>) <span class="co"># Just in case</span></span>
<span id="cb68-13"><a></a>    <span class="fu">tryCatch</span>( <span class="co"># Logrank test and extract p-value (defaults to 1 if only 1 group</span></span>
<span id="cb68-14"><a></a>      cvfit <span class="sc">|&gt;</span> </span>
<span id="cb68-15"><a></a>        stats<span class="sc">::</span><span class="fu">predict</span>(<span class="at">newx =</span> lung_test<span class="sc">$</span>x, <span class="at">s =</span> <span class="st">"lambda.min"</span>, <span class="at">type =</span> <span class="st">"link"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb68-16"><a></a>        dplyr<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">risk_score =</span> _, <span class="at">y =</span> lung_test<span class="sc">$</span>y) <span class="sc">|&gt;</span> </span>
<span id="cb68-17"><a></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">risk_group =</span> dplyr<span class="sc">::</span><span class="fu">if_else</span>(risk_score <span class="sc">&gt;</span> <span class="fu">median</span>(risk_score), <span class="st">"high"</span>, <span class="st">"low"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb68-18"><a></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>risk_score) <span class="sc">|&gt;</span> </span>
<span id="cb68-19"><a></a>        survival<span class="sc">::</span><span class="fu">survdiff</span>(y <span class="sc">~</span> risk_group, <span class="at">data =</span> _) <span class="sc">|&gt;</span> </span>
<span id="cb68-20"><a></a>        purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="st">"pvalue"</span>),</span>
<span id="cb68-21"><a></a>      <span class="at">error =</span> \(e) <span class="dv">1</span> <span class="co"># In case there is only 1 group</span></span>
<span id="cb68-22"><a></a>    )</span>
<span id="cb68-23"><a></a>  },</span>
<span id="cb68-24"><a></a>  <span class="at">FUN.VALUE =</span> <span class="fu">double</span>(<span class="dv">1</span>L)</span>
<span id="cb68-25"><a></a>) <span class="sc">|&gt;</span> </span>
<span id="cb68-26"><a></a>  <span class="fu">sort</span>() <span class="sc">|&gt;</span> </span>
<span id="cb68-27"><a></a>  dplyr<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">p_value =</span> _) <span class="sc">|&gt;</span> </span>
<span id="cb68-28"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">cdf =</span> <span class="fu">seq_along</span>(p_value) <span class="sc">/</span> <span class="fu">length</span>(p_value))</span>
<span id="cb68-29"><a></a>tictoc<span class="sc">::</span><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="memoise-6" class="slide level2 scrollable">
<h2><code>📦memoise</code></h2>
<div class="smaller2">
<ul>
<li>Example below will:
<ul>
<li>Build lung survival data</li>
<li>Train model on 80% of the data</li>
<li>Test on the remaining 20%</li>
<li>Run logrank test and calculate <code>p_value</code></li>
</ul></li>
<li>Repeat 100</li>
<li><span class="highlight"><strong>Plot results</strong></span></li>
</ul>
<div style="margin-top: 30px;">

</div>
<div class="sourceCode" id="cb69" data-code-line-numbers="3-19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a></a><span class="co">#</span></span>
<span id="cb69-2"><a></a><span class="co"># Nice cumulative distribution plot</span></span>
<span id="cb69-3"><a></a>p_values <span class="sc">|&gt;</span></span>
<span id="cb69-4"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb69-5"><a></a>    <span class="at">max_significant =</span> p_value <span class="sc">==</span> <span class="fu">max</span>(p_value[p_value <span class="sc">&lt;=</span> <span class="fl">0.05</span>]),</span>
<span id="cb69-6"><a></a>    <span class="at">label =</span> dplyr<span class="sc">::</span><span class="fu">if_else</span>(max_significant, glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"y = {cdf} / p_value = {round(p_value, 5)}"</span>), <span class="cn">NA_character_</span>),</span>
<span id="cb69-7"><a></a>    <span class="at">yintercept =</span> dplyr<span class="sc">::</span><span class="fu">if_else</span>(max_significant, cdf, <span class="cn">NA</span>),</span>
<span id="cb69-8"><a></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb69-9"><a></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> p_value, <span class="at">y =</span> cdf, <span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb69-10"><a></a>    ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb69-11"><a></a>    ggplot2<span class="sc">::</span><span class="fu">geom_ribbon</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> cdf), <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb69-12"><a></a>    ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.05</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb69-13"><a></a>    ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">yintercept =</span> yintercept), <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb69-14"><a></a>    ggplot2<span class="sc">::</span><span class="fu">geom_label</span>(<span class="at">nudge_x =</span> .<span class="dv">05</span>, <span class="at">nudge_y =</span> <span class="sc">-</span>.<span class="dv">05</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb69-15"><a></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cumulative Distribution of p-values"</span>,</span>
<span id="cb69-16"><a></a>         <span class="at">x =</span> <span class="st">"p-value"</span>,</span>
<span id="cb69-17"><a></a>         <span class="at">y =</span> <span class="st">"Empirical CDF"</span>) <span class="sc">+</span></span>
<span id="cb69-18"><a></a>    ggplot2<span class="sc">::</span><span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb69-19"><a></a>    ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="memoise-7" class="slide level2 smaller">
<h2><code>📦memoise</code></h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>full run: 10.761 sec elapsed</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>memoise run: 3.052 sec elapsed</code></pre>
</div>
</div>

<img data-src="r_as_a_rockstar_files/figure-revealjs/unnamed-chunk-30-1.png" width="960" class="r-stretch"></section></section>
<section>
<section id="rmarkdown-quarto" class="title-slide slide level1" data-background-color="#152330">
<h1>Rmarkdown &amp; Quarto</h1>

</section>
<section id="powerful-reports-presentations" class="slide level2 smaller" data-auto-animate="true" data-background-color="#152330">
<h2 data-id="quarto-animate-title">Powerful reports &amp; presentations</h2>
<ul>
<li>Great tools to communicate results</li>
<li>You can use it to generate reproducible results
<ul>
<li><code>params:</code> property in rmarkdown title</li>
<li><code>rmarkdown::render()</code> <i class="fa-solid fa-hat-wizard" aria-label="hat-wizard"></i></li>
</ul></li>
</ul>
</section>
<section id="powerful-reports-presentations-1" class="slide level2 smaller" data-auto-animate="true" data-background-color="#152330">
<h2 data-id="quarto-animate-title">Powerful reports &amp; presentations</h2>
<ul>
<li><p>Great tools to communicate results</p></li>
<li><p>You can use it to generate reproducible results</p>
<ul>
<li><code>params:</code> property in rmarkdown title</li>
</ul>
<div class="sourceCode" id="cb72" data-code-line-numbers="4-7"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb72-1" class="hljs-ln-code"><a></a><span class="sc">---</span></span>
<span id="cb72-2" class="hljs-ln-code"><a></a>title<span class="sc">:</span> <span class="st">"Network-based models"</span></span>
<span id="cb72-3" class="hljs-ln-code"><a></a>output<span class="sc">:</span> html_document</span>
<span id="cb72-4" class="hljs-ln-code"><a></a>params<span class="sc">:</span></span>
<span id="cb72-5" class="hljs-ln-code"><a></a>  seed<span class="sc">:</span> <span class="dv">2024</span></span>
<span id="cb72-6" class="hljs-ln-code"><a></a>  prop<span class="sc">:</span> <span class="fl">0.8</span></span>
<span id="cb72-7" class="hljs-ln-code"><a></a>  folds<span class="sc">:</span> <span class="dv">10</span></span>
<span id="cb72-8" class="hljs-ln-code"><a></a>  <span class="co"># ...</span></span>
<span id="cb72-9" class="hljs-ln-code"><a></a><span class="sc">---</span></span>
<span id="cb72-10" class="hljs-ln-code"><a></a></span>
<span id="cb72-11" class="hljs-ln-code"><a></a><span class="co"># then use `params$&lt;name&gt; in code</span></span>
<span id="cb72-12" class="hljs-ln-code"><a></a><span class="fu">set.seed</span>(params<span class="sc">$</span>seed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>rmarkdown::render()</code> <i class="fa-solid fa-hat-wizard" aria-label="hat-wizard"></i></li>
</ul></li>
</ul>
</section>
<section id="powerful-reports-presentations-2" class="slide level2 smaller" data-auto-animate="true" data-background-color="#152330">
<h2 data-id="quarto-animate-title">Powerful reports &amp; presentations</h2>
<ul>
<li><p>Great tools to communicate results</p></li>
<li><p>You can use it to generate reproducible results</p>
<ul>
<li><code>params:</code> property in rmarkdown title</li>
<li><code>rmarkdown::render()</code> <i class="fa-solid fa-hat-wizard" aria-label="hat-wizard"></i></li>
</ul>
<div class="sourceCode" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb73-1" class="hljs-ln-code"><a></a>props <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">7</span>)</span>
<span id="cb73-2" class="hljs-ln-code"><a></a>folds <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">5</span>)</span>
<span id="cb73-3" class="hljs-ln-code"><a></a>seed <span class="ot">&lt;-</span> <span class="dv">2025</span> <span class="sc">+</span> <span class="fu">seq_len</span>(<span class="dv">10</span>)</span>
<span id="cb73-4" class="hljs-ln-code"><a></a></span>
<span id="cb73-5" class="hljs-ln-code"><a></a><span class="fu">dir.create</span>(<span class="st">"Results/reports"</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb73-6" class="hljs-ln-code"><a></a>purrr<span class="sc">::</span><span class="fu">walk</span>(seed, \(s)</span>
<span id="cb73-7" class="hljs-ln-code"><a></a>  purrr<span class="sc">::</span><span class="fu">walk</span>(props, \(x) </span>
<span id="cb73-8" class="hljs-ln-code"><a></a>    purrr<span class="sc">::</span><span class="fu">walk</span>(folds, \(y) </span>
<span id="cb73-9" class="hljs-ln-code"><a></a>      rmarkdown<span class="sc">::</span><span class="fu">render</span>(</span>
<span id="cb73-10" class="hljs-ln-code"><a></a>        <span class="st">"network.Rmd"</span>, </span>
<span id="cb73-11" class="hljs-ln-code"><a></a>        <span class="at">output_file =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Results/reports/network_{s}_{x}_{y}.html"</span>), </span>
<span id="cb73-12" class="hljs-ln-code"><a></a>        <span class="at">params =</span> <span class="fu">list</span>(<span class="at">props =</span> x, <span class="at">folds =</span> y, <span class="at">seed =</span> s))</span>
<span id="cb73-13" class="hljs-ln-code"><a></a>    )</span>
<span id="cb73-14" class="hljs-ln-code"><a></a>  )</span>
<span id="cb73-15" class="hljs-ln-code"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="powerful-reports-presentations-3" class="slide level2 smaller" data-background-color="#152330">
<h2>Powerful reports &amp; presentations</h2>
<p>Add to the end of an Rmarkdown:</p>
<div class="sourceCode" id="cb74" data-code-line-numbers="2-7,9-11,13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a></a><span class="do">## Add to end of chunk</span></span>
<span id="cb74-2"><a></a><span class="fu">list</span>(<span class="at">results =</span> <span class="fu">list</span>()) <span class="sc">|&gt;</span> <span class="fu">as.environment</span>()            <span class="co"># Boilerplate</span></span>
<span id="cb74-3"><a></a>results_path <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"results_rmarkdown.RData"</span>) <span class="co"># Path to save</span></span>
<span id="cb74-4"><a></a><span class="cf">if</span> (<span class="fu">file.exists</span>(results_path)) <span class="fu">load</span>(results_path, <span class="at">envir =</span> env) <span class="co"># Load if exists</span></span>
<span id="cb74-5"><a></a></span>
<span id="cb74-6"><a></a>env<span class="sc">$</span>results[[<span class="fu">length</span>(env<span class="sc">$</span>results) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="co"># Add new result</span></span>
<span id="cb74-7"><a></a>  <span class="at">params =</span> params,   <span class="co"># Params from rmarkdown</span></span>
<span id="cb74-8"><a></a>  <span class="at">date=</span> <span class="fu">Sys.time</span>()   <span class="co"># Current time (in case you want to filter)</span></span>
<span id="cb74-9"><a></a>  <span class="at">result =</span> a_result, <span class="co"># A result</span></span>
<span id="cb74-10"><a></a>  <span class="at">model =</span> a_model    <span class="co"># Any other objects you want to save</span></span>
<span id="cb74-11"><a></a>)</span>
<span id="cb74-12"><a></a></span>
<span id="cb74-13"><a></a><span class="fu">save</span>(<span class="st">"results"</span>, <span class="at">file =</span> results_path, <span class="at">envir =</span> env)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section></section>
<section>
<section id="dont-source-files" class="title-slide slide level1 smaller" data-background-color="#6877a1">
<h1>💣 Don’t <code>source</code> files</h1>
<ul>
<li>Difficult to maintain</li>
<li>Code runs inside scripts without any control</li>
<li>Should only be used to store functions
<ul>
<li>There are better alternatives</li>
</ul></li>
</ul>
<div class="fragment">
<div style="margin-top: 50px;">

</div>
<p><span class="highlight"><strong>If you really need</strong></span>, use relative paths:</p>
<ul>
<li><code>here::here("./another.R")</code> <em>(in current directory)</em></li>
<li><code>here::here("../something.R")</code> <em>(in parent directory)</em></li>
<li><em>or</em> <code>here::here("./folder/to/script.R")</code> <em>(in one of the folders)</em></li>
</ul>
</div>
</section>
<section id="alternatives-to-source" class="slide level2 smaller" data-background-color="#6877a1">
<h2>Alternatives to <code>source()</code></h2>
<div class="fragment semi-fade-out" data-fragment-index="1">
<p><code>📦box</code> is a package that allows to import functions from other scripts</p>
<ul>
<li>it encapsulates the code in separate environments</li>
</ul>
<div class="sourceCode" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a></a><span class="co">#' @export</span></span>
<span id="cb75-2"><a></a>fun <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) a <span class="sc">+</span> b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment fade-in-then-semi-out" data-fragment-index="1">
<ul>
<li>Kinda like <code>source(...)</code> but it doesn’t run anything in the current environment</li>
</ul>
<div class="sourceCode" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a></a>box<span class="sc">::</span><span class="fu">use</span>(mod<span class="sc">/</span>another[...])</span>
<span id="cb76-2"><a></a></span>
<span id="cb76-3"><a></a><span class="fu">fun</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment fade-in-then-semi-out">
<ul>
<li>The file can be loaded and then used with its name <code>&lt;filename&gt;$&lt;fun_name&gt;</code></li>
</ul>
<div class="sourceCode" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a></a>box<span class="sc">::</span><span class="fu">use</span>(mod<span class="sc">/</span>another)</span>
<span id="cb77-2"><a></a></span>
<span id="cb77-3"><a></a>another<span class="sc">$</span><span class="fu">fun</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment fade-in-then-semi-out">
<ul>
<li>We can only import some functions</li>
</ul>
<div class="sourceCode" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a></a>box<span class="sc">::</span><span class="fu">use</span>(mod<span class="sc">/</span>another[fun])</span>
<span id="cb78-2"><a></a></span>
<span id="cb78-3"><a></a><span class="fu">fun</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="alternatives-to-source-1" class="slide level2 smaller" data-background-color="#6877a1">
<h2>Alternatives to <code>source()</code></h2>
<p>The real power comes from the restricted scope it can operate in.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79" data-code-line-numbers="2,4,6-7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a></a><span class="co"># 📄 mod/another.R</span></span>
<span id="cb79-2"><a></a>a_variable <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb79-3"><a></a></span>
<span id="cb79-4"><a></a><span class="co">#' @export</span></span>
<span id="cb79-5"><a></a>log <span class="ot">&lt;-</span> <span class="cf">function</span> (msg) {</span>
<span id="cb79-6"><a></a>  box<span class="sc">::</span><span class="fu">use</span>(glue[glue])</span>
<span id="cb79-7"><a></a>  <span class="co"># We can now use `glue` inside the function:</span></span>
<span id="cb79-8"><a></a>  <span class="fu">message</span>(<span class="fu">glue</span>(<span class="at">.sep =</span> <span class="st">" "</span>, <span class="st">"[LOG MESSAGE]"</span>, msg, <span class="at">.envir =</span> <span class="fu">parent.frame</span>()))</span>
<span id="cb79-9"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>a_variable</code> is <span class="highlight"><strong>not overwritten</strong></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80" data-code-line-numbers="2-4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a></a><span class="co"># 📄 report.Rmd</span></span>
<span id="cb80-2"><a></a>a_variable <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb80-3"><a></a>box<span class="sc">::</span><span class="fu">use</span>(mod<span class="sc">/</span>another)</span>
<span id="cb80-4"><a></a>another<span class="sc">$</span><span class="fu">log</span>(<span class="st">"a_variable has value: {a_variable}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[LOG MESSAGE] a_variable has value: 2</code></pre>
</div>
</div>
<p>While with <code>source()</code> it is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82" data-code-line-numbers="2-4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a></a><span class="co"># 📄 report.Rmd</span></span>
<span id="cb82-2"><a></a>a_variable <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb82-3"><a></a><span class="fu">source</span>(<span class="st">"mod/another.R"</span>)</span>
<span id="cb82-4"><a></a>another<span class="sc">$</span><span class="fu">log</span>(<span class="st">"a_variable has value: {a_variable}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[LOG MESSAGE] a_variable has value: 1</code></pre>
</div>
</div>
</section>
<section id="alternatives-to-source-2" class="slide level2 smaller" data-background-color="#6877a1">
<h2>Alternatives to <code>source()</code></h2>
<div style="margin-top: 50px;">

</div>
<p><span class="highlight"><strong>Create your own R package</strong></span></p>
<p>&nbsp; <em>(let’s try a live demo if we have time)</em></p>
</section></section>
<section id="thanks" class="title-slide slide level1">
<h1>Thanks!</h1>



<script type="webr-data">
eyJvcHRpb25zIjp7ImJhc2VVcmwiOiJodHRwczovL3dlYnIuci13YXNtLm9yZy92MC40LjIvIn0sInBhY2thZ2VzIjp7InBrZ3MiOlsiZXZhbHVhdGUiLCJrbml0ciIsImh0bWx0b29scyIsImxvZ2dlciIsImNyYXlvbiIsImdsdWUiLCJkYXRhLnRhYmxlIiwiZHBseXIiLCJ0aWR5ciIsInB1cnJyIiwiZ2x1ZSIsImdncGxvdDIiLCJtZW1vaXNlIiwiZ2xtbmV0IiwicnNhbXBsZSIsInRpY3RvYyIsImJlbmNoIl0sInJlcG9zIjpbXX0sInJlbmRlcl9kZiI6ImRlZmF1bHQifQ==
</script>
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3siY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0xMCIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMTA7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xMCIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzEwID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMTAtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici0xMC1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV8xMCA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfMTAsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC05IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV85O1xuICBpZiAod2luZG93LkhUTUxXaWRnZXRzKSB7XG4gICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpO1xuICB9XG4gIGlmICh3aW5kb3cuUGFnZWRUYWJsZURvYykge1xuICAgIHdpbmRvdy5QYWdlZFRhYmxlRG9jLmluaXRBbGwoKTtcbiAgfVxufVxuIn0seyJjZWxsTmFtZSI6IndlYnItOSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzkgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici05LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHdlYnItOS1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV85ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl85LCB7fSk7XG4ifSx7ImNlbGxOYW1lIjoid2Vici13aWRnZXQtOCIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfODtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLTgiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF93ZWJyX2VkaXRvcl84ID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItOC1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTgtY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgV2ViUkV4ZXJjaXNlRWRpdG9yKHdlYlJPanMud2ViUlByb21pc2UsIGJsb2NrLmNvZGUsIG9wdGlvbnMpO1xuXG4gIHJldHVybiBlZGl0b3IuY29udGFpbmVyO1xufVxuX3dlYnJfdmFsdWVfOCA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfOCwge30pO1xuIn0seyJjZWxsTmFtZSI6IndlYnItd2lkZ2V0LTciLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJ7XG4gIC8vIFdhaXQgZm9yIG91dHB1dCB0byBiZSB3cml0dGVuIHRvIHRoZSBET00sIHRoZW4gdHJpZ2dlciB3aWRnZXQgcmVuZGVyaW5nXG4gIGF3YWl0IF93ZWJyX3ZhbHVlXzc7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici03IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfNyA9IHtcbiAgY29uc3QgeyBXZWJSRXhlcmNpc2VFZGl0b3IsIGI2NERlY29kZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ3ZWJyLTctY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici03LWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzcgPSB3ZWJST2pzLnByb2Nlc3MoX3dlYnJfZWRpdG9yXzcsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC02IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV82O1xuICBpZiAod2luZG93LkhUTUxXaWRnZXRzKSB7XG4gICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpO1xuICB9XG4gIGlmICh3aW5kb3cuUGFnZWRUYWJsZURvYykge1xuICAgIHdpbmRvdy5QYWdlZFRhYmxlRG9jLmluaXRBbGwoKTtcbiAgfVxufVxuIn0seyJjZWxsTmFtZSI6IndlYnItNiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzYgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici02LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHdlYnItNi1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV82ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl82LCB7fSk7XG4ifSx7ImNlbGxOYW1lIjoid2Vici13aWRnZXQtNSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfNTtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLTUiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF93ZWJyX2VkaXRvcl81ID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItNS1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTUtY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgV2ViUkV4ZXJjaXNlRWRpdG9yKHdlYlJPanMud2ViUlByb21pc2UsIGJsb2NrLmNvZGUsIG9wdGlvbnMpO1xuXG4gIHJldHVybiBlZGl0b3IuY29udGFpbmVyO1xufVxuX3dlYnJfdmFsdWVfNSA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfNSwge30pO1xuIn0seyJjZWxsTmFtZSI6IndlYnItd2lkZ2V0LTQiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJ7XG4gIC8vIFdhaXQgZm9yIG91dHB1dCB0byBiZSB3cml0dGVuIHRvIHRoZSBET00sIHRoZW4gdHJpZ2dlciB3aWRnZXQgcmVuZGVyaW5nXG4gIGF3YWl0IF93ZWJyX3ZhbHVlXzQ7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici00IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfNCA9IHtcbiAgY29uc3QgeyBXZWJSRXhlcmNpc2VFZGl0b3IsIGI2NERlY29kZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ3ZWJyLTQtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici00LWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzQgPSB3ZWJST2pzLnByb2Nlc3MoX3dlYnJfZWRpdG9yXzQsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0zIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8zO1xuICBpZiAod2luZG93LkhUTUxXaWRnZXRzKSB7XG4gICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpO1xuICB9XG4gIGlmICh3aW5kb3cuUGFnZWRUYWJsZURvYykge1xuICAgIHdpbmRvdy5QYWdlZFRhYmxlRG9jLmluaXRBbGwoKTtcbiAgfVxufVxuIn0seyJjZWxsTmFtZSI6IndlYnItMyIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzMgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0zLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHdlYnItMy1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV8zID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8zLCB7fSk7XG4ifSx7ImNlbGxOYW1lIjoid2Vici13aWRnZXQtMiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMjtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLTIiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF93ZWJyX2VkaXRvcl8yID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMi1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTItY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgV2ViUkV4ZXJjaXNlRWRpdG9yKHdlYlJPanMud2ViUlByb21pc2UsIGJsb2NrLmNvZGUsIG9wdGlvbnMpO1xuXG4gIHJldHVybiBlZGl0b3IuY29udGFpbmVyO1xufVxuX3dlYnJfdmFsdWVfMiA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfMiwge30pO1xuIn0seyJjZWxsTmFtZSI6IndlYnItd2lkZ2V0LTEiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJ7XG4gIC8vIFdhaXQgZm9yIG91dHB1dCB0byBiZSB3cml0dGVuIHRvIHRoZSBET00sIHRoZW4gdHJpZ2dlciB3aWRnZXQgcmVuZGVyaW5nXG4gIGF3YWl0IF93ZWJyX3ZhbHVlXzE7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMSA9IHtcbiAgY29uc3QgeyBXZWJSRXhlcmNpc2VFZGl0b3IsIGI2NERlY29kZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ3ZWJyLTEtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici0xLWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzEgPSB3ZWJST2pzLnByb2Nlc3MoX3dlYnJfZWRpdG9yXzEsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXByZWx1ZGUiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJ3ZWJST2pzID0ge1xuICBjb25zdCB7IFdlYlIsIENoYW5uZWxUeXBlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lLldlYlI7XG4gIGNvbnN0IHtcbiAgICBXZWJSRXZhbHVhdG9yLFxuICAgIFdlYlJFbnZpcm9ubWVudE1hbmFnZXIsXG4gICAgc2V0dXBSLFxuICAgIGI2NERlY29kZSxcbiAgICBjb2xsYXBzZVBhdGhcbiAgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG5cbiAgY29uc3Qgc3RhdHVzQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJleGVyY2lzZS1sb2FkaW5nLXN0YXR1c1wiKTtcbiAgY29uc3QgaW5kaWNhdG9yQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJleGVyY2lzZS1sb2FkaW5nLWluZGljYXRvclwiKTtcbiAgaW5kaWNhdG9yQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoXCJkLW5vbmVcIik7XG5cbiAgbGV0IHN0YXR1c1RleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpXG4gIHN0YXR1c1RleHQuY2xhc3NMaXN0ID0gXCJleGVyY2lzZS1sb2FkaW5nLWRldGFpbHNcIjtcbiAgc3RhdHVzVGV4dCA9IHN0YXR1c0NvbnRhaW5lci5hcHBlbmRDaGlsZChzdGF0dXNUZXh0KTtcbiAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBJbml0aWFsaXNlYDtcblxuICAvLyBIb2lzdCBpbmRpY2F0b3Igb3V0IGZyb20gZmluYWwgc2xpZGUgd2hlbiBydW5uaW5nIHVuZGVyIHJldmVhbFxuICBjb25zdCByZXZlYWxTdGF0dXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJldmVhbCAuZXhlcmNpc2UtbG9hZGluZy1pbmRpY2F0b3JcIik7XG4gIGlmIChyZXZlYWxTdGF0dXMpIHtcbiAgICByZXZlYWxTdGF0dXMucmVtb3ZlKCk7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZXZlYWwgPiAuc2xpZGVzXCIpLmFwcGVuZENoaWxkKHJldmVhbFN0YXR1cyk7XG4gIH1cblxuICAvLyBNYWtlIGFueSByZXZlYWwgc2xpZGVzIHdpdGggbGl2ZSBjZWxscyBzY3JvbGxhYmxlXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucmV2ZWFsIC5leGVyY2lzZS1jZWxsXCIpLmZvckVhY2goKGVsKSA9PiB7XG4gICAgZWwuY2xvc2VzdCgnc2VjdGlvbi5zbGlkZScpLmNsYXNzTGlzdC5hZGQoXCJzY3JvbGxhYmxlXCIpO1xuICB9KVxuXG4gIC8vIHdlYlIgc3VwcGxlbWVudGFsIGRhdGEgYW5kIG9wdGlvbnNcbiAgY29uc3QgZGF0YUNvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici1kYXRhXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgZGF0YSA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKGRhdGFDb250ZW50KSk7XG5cbiAgLy8gR3JhYiBsaXN0IG9mIHJlc291cmNlcyB0byBiZSBkb3dubG9hZGVkXG4gIGNvbnN0IGZpbGVzQ29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ2ZnMtZmlsZVxcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGZpbGVzID0gSlNPTi5wYXJzZShiNjREZWNvZGUoZmlsZXNDb250ZW50KSk7XG5cbiAgLy8gVXNlIFBvc3RNZXNzYWdlIGNoYW5uZWwgZm9yIGFzeW5jIGNvbW11bmljYXRpb25cbiAgLy8gV2UgZG8gbm90IGV4cGVjdCB0byB0YWtlIG5lc3RlZCBwcm9tcHQgaW5wdXQgaW4gUXVhcnRvIExpdmUgY2VsbHNcbiAgZGF0YS5vcHRpb25zLmNoYW5uZWxUeXBlID0gQ2hhbm5lbFR5cGUuUG9zdE1lc3NhZ2U7XG5cbiAgLy8gSW5pdGlhbGlzZSB3ZWJSIGFuZCBzZXR1cCBmb3IgUiBjb2RlIGV2YWx1YXRpb25cbiAgbGV0IHdlYlJQcm9taXNlID0gKGFzeW5jICh3ZWJSKSA9PiB7XG4gICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBEb3dubG9hZGluZyB3ZWJSYDtcbiAgICBhd2FpdCB3ZWJSLmluaXQoKTtcblxuICAgIC8vIEluc3RhbGwgcHJvdmlkZWQgbGlzdCBvZiBwYWNrYWdlc1xuICAgIC8vIEVuc3VyZSB3ZWJSIGRlZmF1bHQgcmVwbyBpcyBpbmNsdWRlZFxuICAgIGRhdGEucGFja2FnZXMucmVwb3MucHVzaChcImh0dHBzOi8vcmVwby5yLXdhc20ub3JnXCIpXG4gICAgYXdhaXQgZGF0YS5wYWNrYWdlcy5wa2dzLm1hcCgocGtnKSA9PiAoKSA9PiB7XG4gICAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gYERvd25sb2FkaW5nIHBhY2thZ2U6ICR7cGtnfWA7XG4gICAgICByZXR1cm4gd2ViUi5ldmFsUlZvaWQoYFxuICAgICAgICB3ZWJyOjppbnN0YWxsKHBrZywgcmVwb3MgPSByZXBvcylcbiAgICAgICAgbGlicmFyeShwa2csIGNoYXJhY3Rlci5vbmx5ID0gVFJVRSlcbiAgICAgIGAsIHsgZW52OiB7XG4gICAgICAgIHBrZzogcGtnLFxuICAgICAgICByZXBvczogZGF0YS5wYWNrYWdlcy5yZXBvcyxcbiAgICAgIH19KTtcbiAgICB9KS5yZWR1Y2UoKGN1ciwgbmV4dCkgPT4gY3VyLnRoZW4obmV4dCksIFByb21pc2UucmVzb2x2ZSgpKTtcblxuICAgIC8vIERvd25sb2FkIGFuZCBpbnN0YWxsIHJlc291cmNlc1xuICAgIGF3YWl0IGZpbGVzLm1hcCgoZmlsZSkgPT4gYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbmFtZSA9IGZpbGUuc3Vic3RyaW5nKGZpbGUubGFzdEluZGV4T2YoJy8nKSArIDEpO1xuICAgICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBEb3dubG9hZGluZyByZXNvdXJjZTogJHtuYW1lfWA7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGZpbGUpO1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbid0IGRvd25sb2FkIFxcYCR7ZmlsZX1cXGAuIEVycm9yICR7cmVzcG9uc2Uuc3RhdHVzfTogXCIke3Jlc3BvbnNlLnN0YXR1c1RleHR9XCIuYCk7XG4gICAgICB9XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuYXJyYXlCdWZmZXIoKTtcblxuICAgICAgLy8gU3RvcmUgVVJMcyBpbiB0aGUgY3dkIHdpdGhvdXQgYW55IHN1YmRpcmVjdG9yeSBzdHJ1Y3R1cmVcbiAgICAgIGlmIChmaWxlLmluY2x1ZGVzKFwiOi8vXCIpKSB7XG4gICAgICAgIGZpbGUgPSBuYW1lO1xuICAgICAgfVxuXG4gICAgICAvLyBDb2xsYXBzZSBoaWdoZXIgZGlyZWN0b3J5IHN0cnVjdHVyZVxuICAgICAgZmlsZSA9IGNvbGxhcHNlUGF0aChmaWxlKTtcblxuICAgICAgLy8gQ3JlYXRlIGRpcmVjdG9yeSB0cmVlLCBpZ25vcmluZyBcImRpcmVjdG9yeSBleGlzdHNcIiBWRlMgZXJyb3JzXG4gICAgICBjb25zdCBwYXJ0cyA9IGZpbGUuc3BsaXQoJy8nKS5zbGljZSgwLCAtMSk7XG4gICAgICBsZXQgcGF0aCA9ICcnO1xuICAgICAgd2hpbGUgKHBhcnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcGF0aCArPSBwYXJ0cy5zaGlmdCgpICsgJy8nO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IHdlYlIuRlMubWtkaXIocGF0aCk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBpZiAoIWUubWVzc2FnZS5pbmNsdWRlcyhcIkZTIGVycm9yXCIpKSB7XG4gICAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBXcml0ZSB0aGlzIGZpbGUgdG8gdGhlIFZGU1xuICAgICAgcmV0dXJuIGF3YWl0IHdlYlIuRlMud3JpdGVGaWxlKGZpbGUsIG5ldyBVaW50OEFycmF5KGRhdGEpKTtcbiAgICB9KS5yZWR1Y2UoKGN1ciwgbmV4dCkgPT4gY3VyLnRoZW4obmV4dCksIFByb21pc2UucmVzb2x2ZSgpKTtcblxuICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgSW5zdGFsbGluZyB3ZWJSIHNoaW1zYDtcbiAgICBhd2FpdCB3ZWJSLmV2YWxSVm9pZChgd2Vicjo6c2hpbV9pbnN0YWxsKClgKTtcblxuICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgV2ViUiBlbnZpcm9ubWVudCBzZXR1cGA7XG4gICAgYXdhaXQgc2V0dXBSKHdlYlIsIGRhdGEpO1xuXG4gICAgc3RhdHVzVGV4dC5yZW1vdmUoKTtcbiAgICBpZiAoc3RhdHVzQ29udGFpbmVyLmNoaWxkcmVuLmxlbmd0aCA9PSAwKSB7XG4gICAgICBzdGF0dXNDb250YWluZXIucGFyZW50Tm9kZS5yZW1vdmUoKTtcbiAgICB9XG4gICAgcmV0dXJuIHdlYlI7XG4gIH0pKG5ldyBXZWJSKGRhdGEub3B0aW9ucykpO1xuXG4gIC8vIEtlZXAgdHJhY2sgb2YgaW5pdGlhbCBPSlMgYmxvY2sgcmVuZGVyXG4gIGNvbnN0IHJlbmRlcmVkT2pzID0ge307XG5cbiAgY29uc3QgcHJvY2VzcyA9IGFzeW5jIChjb250ZXh0LCBpbnB1dHMpID0+IHtcbiAgICBjb25zdCB3ZWJSID0gYXdhaXQgd2ViUlByb21pc2U7XG4gICAgY29uc3QgZXZhbHVhdG9yID0gbmV3IFdlYlJFdmFsdWF0b3Iod2ViUiwgY29udGV4dClcbiAgICBhd2FpdCBldmFsdWF0b3IucHJvY2VzcyhpbnB1dHMpO1xuICAgIHJldHVybiBldmFsdWF0b3IuY29udGFpbmVyO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBwcm9jZXNzLFxuICAgIHdlYlJQcm9taXNlLFxuICAgIHJlbmRlcmVkT2pzLFxuICB9O1xufVxuIn1dfQ==
</script>
<div id="exercise-loading-indicator" class="exercise-loading-indicator d-none d-flex align-items-center gap-2">
<div id="exercise-loading-status" class="d-flex gap-2">

</div>
<div class="spinner-grow spinner-grow-sm">

</div>
</div>
<script type="vfs-file">
W10=
</script>
<aside><div>
<p><span class="highlight-soft"><em>Take some cool Appsilon’s package stickers with you</em></span></p>
</div></aside></section>


    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script type="ojs-module-contents">
    eyJjb250ZW50cyI6W119
    </script>
    <script type="module">
    if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
    window._ojs.paths.runtimeToDoc = "../..";
    window._ojs.paths.runtimeToRoot = "../..";
    window._ojs.paths.docToRoot = "";
    window._ojs.selfContained = false;
    window._ojs.runtime.interpretFromScriptTags();
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/averissimo\.github\.io\/code_in_r_as_a_rockstart\/");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>